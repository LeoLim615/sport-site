
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>âš½ å®æ—¶æ¯”åˆ†</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    .league-group { margin-bottom: 30px; }
    .league-title { font-weight: bold; font-size: 18px; margin-bottom: 10px; }
    .live-match {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 10px;
      background: #fff;
      gap: 5px;
    }
    .score-button {
      cursor: pointer;
      grid-column: 2 / span 2;
      text-align: center;
      font-weight: bold;
      background: #eee;
      border-radius: 4px;
      padding: 5px;
    }
    .match-details {
      grid-column: 1 / span 4;
      margin-top: 10px;
      font-size: 14px;
      background: #fff8dc;
      padding: 8px;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<h2>âš½ å®æ—¶æ¯”åˆ†</h2>
<div id="live-scores">åŠ è½½ä¸­...</div>

<script>
const apiKey = '508029';
const apiUrl = `https://www.thesportsdb.com/api/v2/json/${apiKey}/livescore.php?s=soccer`;

fetch(apiUrl)
  .then(res => res.json())
  .then(data => {
    const container = document.getElementById('live-scores');
    if (!data.livescore || data.livescore.length === 0) {
      container.innerHTML = 'ğŸ“­ ç›®å‰æ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„æ¯”èµ›';
      return;
    }

    const grouped = {};
    data.livescore.forEach(match => {
      const league = match.strLeague || 'å…¶ä»–è”èµ›';
      if (!grouped[league]) grouped[league] = [];
      grouped[league].push(match);
    });

    container.innerHTML = '';
    for (const league in grouped) {
      const groupDiv = document.createElement('div');
      groupDiv.className = 'league-group';
      groupDiv.innerHTML = `<div class="league-title">ğŸ† ${league}</div>`;

      grouped[league].forEach(match => {
        const {
          idEvent, strHomeTeam, strAwayTeam, intHomeScore, intAwayScore,
          strStatus, strProgress, dateEvent, strEventTime,
          strHomeTeamBadge, strAwayTeamBadge
        } = match;

        const utcDateTime = (dateEvent && strEventTime) ? `${dateEvent} ${strEventTime}` : '';

        const matchDiv = document.createElement('div');
        matchDiv.className = 'live-match';

        matchDiv.innerHTML = `
          <div style="grid-column: 1 / span 4;">ğŸ•’ å¼€çƒæ—¶é—´: 
            <span class="convert-time" data-datetime="${utcDateTime}">UTCæ—¶é—´åŠ è½½ä¸­...</span>
          </div>
          <div style="text-align:left; display:flex; align-items:center; gap:6px;">
            ${strHomeTeamBadge ? `<img src="${strHomeTeamBadge}" style="height:20px;">` : ''}
            ${strHomeTeam}
          </div>
          <div class="score-button" data-id="${idEvent}">
            ${intHomeScore} - ${intAwayScore}<br>
            <small>â±ï¸ ${strStatus}${strProgress ? ' | ' + strProgress + 'â€²' : ''}</small>
          </div>
          <div style="text-align:right; display:flex; justify-content:flex-end; align-items:center; gap:6px;">
            ${strAwayTeam}
            ${strAwayTeamBadge ? `<img src="${strAwayTeamBadge}" style="height:20px;">` : ''}
          </div>
          <div class="match-details" id="details-${idEvent}" style="display:none;">åŠ è½½ä¸­...</div>
        `;

        groupDiv.appendChild(matchDiv);
      });

      container.appendChild(groupDiv);
    }

    document.querySelectorAll('.convert-time').forEach(el => {
      const utc = el.dataset.datetime;
      if (!utc) return;
      const local = new Date(utc + ' UTC');
      el.textContent = local.toLocaleString();
    });

    document.querySelectorAll('.score-button').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.id;
        const detailBox = document.getElementById(`details-${id}`);
        if (detailBox.style.display === 'block') {
          detailBox.style.display = 'none';
          return;
        }

        detailBox.style.display = 'block';
        detailBox.textContent = 'â³ æ­£åœ¨åŠ è½½è¯¦ç»†äº‹ä»¶...';

        fetch(`https://www.thesportsdb.com/api/v2/json/${apiKey}/lookup/event_timeline/${id}`)
          .then(res => res.json())
          .then(data => {
            if (!data.timeline || data.timeline.length === 0) {
              detailBox.textContent = 'âš ï¸ æ²¡æœ‰è¯¦ç»†äº‹ä»¶æ•°æ®';
              return;
            }

            const html = data.timeline.map(item => {
              let icon = 'âš½ï¸';
              if (item.strTimeline === 'Goal') icon = 'âš½ï¸ è¿›çƒ';
              else if (item.strTimeline === 'Yellow Card') icon = 'ğŸŸ¨ é»„ç‰Œ';
              else if (item.strTimeline === 'Red Card') icon = 'ğŸŸ¥ çº¢ç‰Œ';
              else if (item.strTimeline === 'Substitution') icon = 'ğŸ”„ æ¢äºº';
              return `â±ï¸ ${item.intTime}' ${icon}: <strong>${item.strPlayer}</strong> ${item.strTimelineDetail || ''}`;
            }).join('<br>');
            detailBox.innerHTML = html;
          })
          .catch(err => {
            detailBox.textContent = 'âš ï¸ åŠ è½½å¤±è´¥';
            console.error(err);
          });
      });
    });
  })
  .catch(err => {
    document.getElementById('live-scores').innerHTML = 'âš ï¸ æ— æ³•è·å–å®æ—¶æ¯”åˆ†';
    console.error(err);
  });
</script>

</body>
</html>
